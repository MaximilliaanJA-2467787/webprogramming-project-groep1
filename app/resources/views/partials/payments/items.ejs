<div class="row row-cols-1 row-cols-sm-2 row-cols-md-2 row-cols-xl-3 g-3">
  <% if (!menu || menu.length === 0) { %>
    <div class="col">
      <div class="card p-3 text-center">
        <div class="text-muted">No items found</div>
      </div>
    </div>
  <% } else { %>
    <% menu.forEach(item => { %>
      <div class="col">
        <div class="card h-100 shadow-sm border-0">
          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <div>
                <h6 class="mb-1 text-truncate" title="<%= item.name %>"><%= item.name %></h6>
                <small class="text-muted"><%= item.category_name || 'â€”' %></small>
              </div>
              <div class="text-end">
                <div class="fw-bold text-primary"><%= item.price_tokens %> tok</div>
              </div>
            </div>

            <p class="small text-muted mb-3" style="flex:1; min-height: 2.5em;">
              <%= (() => {
                    try {
                      const meta = item.metadata ? JSON.parse(item.metadata) : {};
                      return (meta.description && meta.description.slice(0,120)) || 'Delicious and freshly prepared.';
                    } catch(e) {
                      return 'Delicious and freshly prepared.';
                    }
                  })() %>
            </p>

            <div class="d-flex gap-2 align-items-center">
              <div class="input-group input-group-sm me-auto" style="max-width:110px;">
                <button type="button" class="btn btn-outline-secondary btn-decr" data-item-id="<%= item.id %>">-</button>
                <input type="number" min="1" value="1" class="form-control text-center qty-input" data-item-id="<%= item.id %>">
                <button type="button" class="btn btn-outline-secondary btn-incr" data-item-id="<%= item.id %>">+</button>
              </div>

              <button class="btn btn-sm btn-primary add-to-cart" type="button"
                data-item-id="<%= item.id %>"
                data-item-name="<%= item.name.replace(/"/g, '&quot;') %>"
                data-item-price="<%= item.price_tokens %>">
                <i class="bi bi-cart-plus me-1"></i>Add
              </button>
            </div>
          </div>

          <div class="card-footer bg-white border-0 small text-muted d-flex justify-content-between">
            <div>Sold: <%= item.popularity_count || 0 %></div>
            <div><small>ID: <%= item.id %></small></div>
          </div>
        </div>
      </div>
    <% }) %>
  <% } %>
</div>
